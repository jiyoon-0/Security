## VPN
* VPN이란?
   - 공중망을 이용하여 사설 네트워크를 가상으로 연결하는 기술
   - 전용회선 대신 공중망의 저렴한 비용과 사설 IP 통신 가능

* IPSec VPN
 1) 개념 및 특징
    - Site-to-Site VPN 뿐 아니라 개별 사용자를 연결하는 원격 접속 VPN까지 가능한 기술
    - 터널을 경유하는 트래픽을 암호화해 전송 중에 유출되더라도 정보 보호
    - IKE(Internet Key Exchange)라는 키 정보 교환 절차 필요 
    
 2) 동작 과정
    - IPSec 통신은 물리적으로 사용자 정보를 특정 키 정보로 암호화해 암호문 형태로 전달하고 수신자는 키를 사용해 복호화해 정보를 수신하는 과정
    - 첫 번째 터널은 암호화에 필요한 키 정보를 교환하기 위한 보안 터널, 두 번째 터널은 실제 암호화된 사용자 트래픽이 경유하는 보안 터널(IPSec 동작에 두 개의 터널 필요)
    - IKE Phase 1
      - 트래픽을 암호화하는 데 사용되는 인증 키, 열쇠 전달을 위한 보안 터널을 생성하는 단계
      - IPSec Peer 인증 및 키 정보 교환을 위한 보안 채널 생성   
        *) SA(Security Association) : IPSec Peer 간에 생성되는 보안 터널
      - Main Mode : IPSec Peer 대화를 위한 보안 채널 형성을 위해 단계별 협상 진행(6개의 메시지 교환)   
         - Peer 신분 정보 암호화되어 Peer의 신분이 외부에 노출되지 않음
      - Aggressive Mode : 보안 세션 연결을 시도하는 Peer가 모든 정보에 대해 일괄적인 협상 시도(3개의 메시지 교환)   
         - 첫 번째 메시지에 신분 정보를 포함하여 외부에 노출될 가능성이 있지만 속도와 자원 사용량 우수    
        *) ISAKMP(Internet Security Association and Key Management Protocol) : 보안 채널을 생성함으로써 인터넷 환경에서 키 정보를 암호문 형태로 교환할 수 있게 개발된 키 보안 프로토콜(1단계의 결과물)
    - IKE Phase 2 
      - 사용자 트래픽의 암호화를 위한 터널 생성(IPSec SA)
      - ISAKMP SA를 기반으로 인증 정책을 협상하므로 ISAKMP 터널 필수
      - IPSec SA는 단방향 통신으로 송신 터널과 수신 터널 요구(보안성 향상)
      - 단방향 터널로 사용자 트래픽이 암호화 될 때 암호화 패킷에 AH, ESP 보안 프로토콜 정보 삽입   
      *) AH(Authentication Header) : 인증을 위한 헤더를 제공하는 프로토콜, 암호화를 제공하지 않고 인증을 통해 패킷 조작 여부 작업을 수행   
      *) ESP(Encapsulating Security Payload) : 보안을 위해 페이로드를 캡슐화 하는 프로토콜, 상위 계층 정보인 페이로드의 캡슐화(암호화) 제공   
   - 모드
     - 터널 모드(Tunnel Mode) : 사용자 패킷 전체를 암호화 하고 새로운 L3 헤더를 추가하는 방식(추가된 L3 헤더를 기반으로 라우팅), 원래 패킷의 헤더는 라우팅 시 사용되지 않고 원래 사용자 패킷 전체를 암호화하는 방식
     - 전송 모드(Transport Mode) : L3 헤더를 제외한 상위 계층 정보만 암호화, 사용자 데이터만 보호
   
  3) 설정
     - IKE 1단계
       - 키 정보 교환을 위한 보안 터널을 생성하는 ISAKMP 설정
       - ISAKMP 보안 터널을 위해 필요한 암호화, 인증, 해시 및 디피-헬만 그룹 정의
         ex) 암호화 - AES, 인증 - Preshare, 해시 - SHA, 디피-헬만 그룹 - 그룹2   
         AES, DES, 3DES / Pre-share or RSA / MD5 or SHA, SHA-256, SHA-384, SHA-512   
       - isakmp policy : 여러 Peer를 가지며 정책이 모두 다를 때 낮은 번호가 가장 높은 선호도   
       - Pre-share : 사전에 인증 키를 상호간에 물리적으로 공유(관리자가 인증 패스워드를 미리 정해놓고 사용, 인증키 직접 설정 필요)
       - 암호화 알고리즘 : DES 가장 가벼운 알고리즘
       - 디피-헬만 그룹 : 키 암호화 교환을 위한 알고리즘 그룹
       - 해시 : 중간 정도의 SHA-256을 가장 많이 사용
     - IKE 2단계
       - 실제 트래픽을 암호화해 전달할 IPSec SA 생성을 위한 설정
       - 터널에 대한 암호화 기법 및 해시 기법을 정의
     - 대상 트래픽 정의
       - IPSec 암호화가 되어야 할 트래픽 정의
     - 라우팅
       - 어떤 라우터 또는 VPN 장비와 IPSec VPN 통신을 수행할 것인지 정의
     - 인터페이스
       - 어떤 인터페이스에 암호화 맵을 정의할 것인지 정의
       *) 생존시간 : ISAKMP SA가 활성화 되는 시간(외부 침입에 의해 ISAKMP 보안 터널에 대한 정보가 노출될 우려)
      
